--INTRODUCCION A LOS CURSORES
--CLASE DEL MIERCOLES 15-06-16

CREATE TABLE NOMINA(ID INTEGER, SUELDO_BASE FLOAT, HORAS_LABORADAS INTEGER);
/*
PROBLEMA: SE DESEA REALIZAR UN PROGRAMA QUE HAGA EL PAGO DE NOMINA DE LOS TRABAJADORES 
SIGUIENTES, EL PAGO SE DEBE ESTABLECER COMO EL PRODUCTO ENTRE LAS HORAS LABORADORAS Y EL SUELDO
BASE, SI LAS HORAS LABORADAS SON MAS DE 20, EL EXCEDENTE DEBE SER 20 POR CIENTO ADICIONAL AL ESTABLECIDO
EN LAS HORAS LABORADAS, PRESENTAR EL PAGO DE NOMINA COMO UNA COLUMNA ADICIONAL
*/

INSERT INTO NOMINA VALUES(1, 100, 18);
INSERT INTO NOMINA VALUES(2, 100, 23);
INSERT INTO NOMINA VALUES(3, 100, 19);
INSERT INTO NOMINA VALUES(4, 100, 40);
INSERT INTO NOMINA VALUES(5, 100, 30);
SELECT * FROM NOMINA;


--CREACION DE UN CURSOR BASICO
SET SERVEROUTPUT ON; --PERMITE VER LAS SALIDAS
DECLARE
--AQUI DECLARAMOS EL CURSOR
CURSOR CUR_NOMINA 
IS 
  SELECT * FROM NOMINA;
  PAGO FLOAT;
  EXCEDENTE FLOAT;
BEGIN 
  FOR REC IN CUR_NOMINA LOOP
  PAGO:=0; 
  PAGO:=REC.HORAS_LABORADAS*REC.SUELDO_BASE;
  IF REC.HORAS_LABORADAS > 20 THEN
  EXCEDENTE:=(REC.HORAS_LABORADAS-20)*(REC.SUELDO_BASE*.20);
  PAGO:=PAGO+EXCEDENTE;
  END IF;
  DBMS_OUTPUT.PUT_LINE(' HORAS LABORADAS: '|| REC.HORAS_LABORADAS ||' PAGO_EFECTUADO: '|| PAGO);
  END LOOP;
END;
/
/*
SUPONER QUE YA TERMIO LA QUINCENA Y QUE LOS TRABAJADORES COBRARON SU PAGO COMO ESTA EMPRESA ES UN MUNDO IMAGINARIO
DECIDE PREMIAR CON 5 HORAS ADICIONALES INICIAES PARA LA NUEVA QUINCENA A AQUELLOS QUE TRABAJARON MAS DE 20 HORAS
LOS OTROS FLOJOS TENDRAN INICIALMENTE CERO HORAS AL INICIO DE QUINCENA
*/



DECLARE
--AQUI DECLARAMOS EL CURSOR
CURSOR CUR_QUINCENA IS SELECT * FROM NOMINA FOR UPDATE;
BEGIN
FOR FILA IN CUR_QUINCENA LOOP
IF FILA.HORAS_LABORADAS > 20 THEN
UPDATE NOMINA SET HORAS_LABORADAS=5 WHERE CURRENT OF CUR_QUINCENA;
ELSE
UPDATE NOMINA SET HORAS_LABORADAS=0 WHERE CURRENT OF CUR_QUINCENA;
END IF;
END LOOP;
END;
/



